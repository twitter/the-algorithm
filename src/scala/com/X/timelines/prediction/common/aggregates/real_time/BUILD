heron_binary(
    name = "heron-without-jass",
    main = "com.X.timelines.prediction.common.aggregates.real_time.TypeSafeRunner",
    oss = True,
    platform = "java8",
    runtime_platform = "java8",
    tags = ["bazel-compatible"],
    dependencies = [
        ":real_time",
        "3rdparty/jvm/org/slf4j:slf4j-jdk14",
    ],
)

jvm_app(
    name = "rta_heron",
    binary = ":heron-without-jass",
    bundles = [
        bundle(
            fileset = ["resources/jaas.conf"],
        ),
    ],
    tags = [
        "bazel-compatible",
        "bazel-only",
    ],
)

scala_library(
    sources = ["*.scala"],
    platform = "java8",
    strict_deps = False,
    tags = ["bazel-compatible"],
    dependencies = [
        ":online-configs",
        "3rdparty/src/jvm/com/X/summingbird:storm",
        "src/java/com/X/heron/util",
        "src/java/com/X/ml/api:api-base",
        "src/java/com/X/ml/api/constant",
        "src/scala/com/X/frigate/data_pipeline/features_aggregated/core:core-features",
        "src/scala/com/X/ml/api/util",
        "src/scala/com/X/storehaus_internal/memcache",
        "src/scala/com/X/storehaus_internal/util",
        "src/scala/com/X/summingbird_internal/bijection:bijection-implicits",
        "src/scala/com/X/summingbird_internal/runner/store_config",
        "src/scala/com/X/summingbird_internal/runner/storm",
        "src/scala/com/X/summingbird_internal/sources/storm/remote:ClientEventSourceScrooge2",
        "src/scala/com/X/timelines/prediction/adapters/client_log_event",
        "src/scala/com/X/timelines/prediction/adapters/client_log_event_mr",
        "src/scala/com/X/timelines/prediction/features/client_log_event",
        "src/scala/com/X/timelines/prediction/features/common",
        "src/scala/com/X/timelines/prediction/features/list_features",
        "src/scala/com/X/timelines/prediction/features/recap",
        "src/scala/com/X/timelines/prediction/features/user_health",
        "src/thrift/com/X/ml/api:data-java",
        "src/thrift/com/X/timelines/suggests/common:record-scala",
        "timelinemixer/common/src/main/scala/com/X/timelinemixer/clients/served_features_cache",
        "timelines/data_processing/ml_util/aggregation_framework:common_types",
        "timelines/data_processing/ml_util/aggregation_framework/heron",
        "timelines/data_processing/ml_util/aggregation_framework/job",
        "timelines/data_processing/ml_util/aggregation_framework/metrics",
        "timelines/data_processing/ml_util/transforms",
        "timelines/src/main/scala/com/X/timelines/clients/memcache_common",
        "util/util-core:scala",
    ],
)

scala_library(
    name = "online-configs",
    sources = [
        "AuthorFeaturesAdapter.scala",
        "Event.scala",
        "FeatureStoreUtils.scala",
        "StormAggregateSourceUtils.scala",
        "TimelinesOnlineAggregationConfig.scala",
        "TimelinesOnlineAggregationConfigBase.scala",
        "TimelinesOnlineAggregationSources.scala",
        "TimelinesStormAggregateSource.scala",
        "TweetFeaturesReadableStore.scala",
        "UserFeaturesAdapter.scala",
        "UserFeaturesReadableStore.scala",
    ],
    platform = "java8",
    strict_deps = True,
    tags = ["bazel-compatible"],
    dependencies = [
        ":base-config",
        "3rdparty/src/jvm/com/X/scalding:db",
        "3rdparty/src/jvm/com/X/storehaus:core",
        "3rdparty/src/jvm/com/X/summingbird:core",
        "3rdparty/src/jvm/com/X/summingbird:online",
        "3rdparty/src/jvm/com/X/summingbird:storm",
        "abuse/detection/src/main/thrift/com/X/abuse/detection/mention_interactions:thrift-scala",
        "snowflake/src/main/scala/com/X/snowflake/id",
        "snowflake/src/main/thrift:thrift-scala",
        "src/java/com/X/ml/api:api-base",
        "src/java/com/X/ml/api/constant",
        "src/scala/com/X/frigate/data_pipeline/features_aggregated/core:core-features",
        "src/scala/com/X/ml/api/util:datarecord",
        "src/scala/com/X/ml/featurestore/catalog/datasets/geo:geo-user-location",
        "src/scala/com/X/ml/featurestore/catalog/datasets/magicrecs:user-features",
        "src/scala/com/X/ml/featurestore/catalog/entities/core",
        "src/scala/com/X/ml/featurestore/catalog/features/core:user",
        "src/scala/com/X/ml/featurestore/catalog/features/geo",
        "src/scala/com/X/ml/featurestore/catalog/features/magicrecs:user-activity",
        "src/scala/com/X/ml/featurestore/catalog/features/magicrecs:user-info",
        "src/scala/com/X/ml/featurestore/catalog/features/trends:tweet_trends_scores",
        "src/scala/com/X/ml/featurestore/lib/data",
        "src/scala/com/X/ml/featurestore/lib/dataset/offline",
        "src/scala/com/X/ml/featurestore/lib/export/strato:app-names",
        "src/scala/com/X/ml/featurestore/lib/feature",
        "src/scala/com/X/ml/featurestore/lib/online",
        "src/scala/com/X/ml/featurestore/lib/params",
        "src/scala/com/X/storehaus_internal/util",
        "src/scala/com/X/summingbird_internal/bijection:bijection-implicits",
        "src/scala/com/X/summingbird_internal/runner/store_config",
        "src/scala/com/X/summingbird_internal/runner/storm",
        "src/scala/com/X/summingbird_internal/sources/common",
        "src/scala/com/X/summingbird_internal/sources/common/remote:ClientEventSourceScrooge",
        "src/scala/com/X/summingbird_internal/sources/storm/remote:ClientEventSourceScrooge2",
        "src/scala/com/X/timelines/prediction/adapters/client_log_event",
        "src/scala/com/X/timelines/prediction/adapters/client_log_event_mr",
        "src/scala/com/X/timelines/prediction/common/adapters:base",
        "src/scala/com/X/timelines/prediction/common/adapters:engagement-converter",
        "src/scala/com/X/timelines/prediction/common/aggregates",
        "src/scala/com/X/timelines/prediction/features/client_log_event",
        "src/scala/com/X/timelines/prediction/features/common",
        "src/scala/com/X/timelines/prediction/features/list_features",
        "src/scala/com/X/timelines/prediction/features/recap",
        "src/scala/com/X/timelines/prediction/features/user_health",
        "src/thrift/com/X/clientapp/gen:clientapp-scala",
        "src/thrift/com/X/dal/personal_data:personal_data-java",
        "src/thrift/com/X/ml/api:data-java",
        "src/thrift/com/X/timelines/suggests/common:engagement-java",
        "src/thrift/com/X/timelines/suggests/common:engagement-scala",
        "src/thrift/com/X/timelines/suggests/common:record-scala",
        "src/thrift/com/X/timelineservice/injection:thrift-scala",
        "src/thrift/com/X/timelineservice/server/suggests/logging:thrift-scala",
        "strato/src/main/scala/com/X/strato/client",
        "timelinemixer/common/src/main/scala/com/X/timelinemixer/clients/served_features_cache",
        "timelines/data_processing/ad_hoc/suggests/common:raw_training_data_creator",
        "timelines/data_processing/ml_util/aggregation_framework:common_types",
        "timelines/data_processing/ml_util/aggregation_framework/heron:configs",
        "timelines/data_processing/ml_util/aggregation_framework/metrics",
        "timelines/data_processing/ml_util/transforms",
        "timelines/data_processing/util:rich-request",
        "tweetsource/common/src/main/thrift:thrift-scala",
        "X-server-internal/src/main/scala",
        "unified_user_actions/client/src/main/scala/com/X/unified_user_actions/client/config",
        "unified_user_actions/client/src/main/scala/com/X/unified_user_actions/client/summingbird",
        "unified_user_actions/thrift/src/main/thrift/com/X/unified_user_actions:unified_user_actions-scala",
        "util/util-core:scala",
        "util/util-stats/src/main/scala/com/X/finagle/stats",
    ],
)

scala_library(
    name = "base-config",
    sources = [
        "AuthorFeaturesAdapter.scala",
        "TimelinesOnlineAggregationConfigBase.scala",
        "TweetFeaturesAdapter.scala",
        "UserFeaturesAdapter.scala",
    ],
    platform = "java8",
    strict_deps = True,
    tags = ["bazel-compatible"],
    dependencies = [
        "src/java/com/X/ml/api:api-base",
        "src/java/com/X/ml/api/constant",
        "src/resources/com/X/timelines/prediction/common/aggregates/real_time",
        "src/scala/com/X/ml/api/util:datarecord",
        "src/scala/com/X/ml/featurestore/catalog/datasets/magicrecs:user-features",
        "src/scala/com/X/ml/featurestore/catalog/entities/core",
        "src/scala/com/X/ml/featurestore/catalog/features/core:user",
        "src/scala/com/X/ml/featurestore/catalog/features/geo",
        "src/scala/com/X/ml/featurestore/catalog/features/magicrecs:user-activity",
        "src/scala/com/X/ml/featurestore/catalog/features/magicrecs:user-info",
        "src/scala/com/X/ml/featurestore/catalog/features/trends:tweet_trends_scores",
        "src/scala/com/X/ml/featurestore/lib/data",
        "src/scala/com/X/ml/featurestore/lib/feature",
        "src/scala/com/X/timelines/prediction/common/adapters:base",
        "src/scala/com/X/timelines/prediction/common/adapters:engagement-converter",
        "src/scala/com/X/timelines/prediction/common/aggregates",
        "src/scala/com/X/timelines/prediction/features/client_log_event",
        "src/scala/com/X/timelines/prediction/features/common",
        "src/scala/com/X/timelines/prediction/features/list_features",
        "src/scala/com/X/timelines/prediction/features/recap",
        "src/scala/com/X/timelines/prediction/features/user_health",
        "src/thrift/com/X/dal/personal_data:personal_data-java",
        "src/thrift/com/X/ml/api:feature_context-java",
        "src/thrift/com/X/timelines/suggests/common:engagement-scala",
        "timelines/data_processing/ml_util/aggregation_framework:common_types",
        "timelines/data_processing/ml_util/aggregation_framework/heron:base-config",
        "timelines/data_processing/ml_util/aggregation_framework/metrics",
        "timelines/data_processing/ml_util/transforms",
        "util/util-core:scala",
        "util/util-core:util-core-util",
    ],
)
