package com.twittew.home_mixew.functionaw_component.featuwe_hydwatow

impowt com.twittew.finagwe.stats.statsweceivew
i-impowt com.twittew.home_mixew.modew.homefeatuwes.authowidfeatuwe
i-impowt com.twittew.home_mixew.modew.homefeatuwes.excwusiveconvewsationauthowidfeatuwe
i-impowt c-com.twittew.home_mixew.modew.homefeatuwes.innetwowkfeatuwe
i-impowt c-com.twittew.home_mixew.modew.homefeatuwes.inwepwytotweetidfeatuwe
i-impowt com.twittew.home_mixew.modew.homefeatuwes.ishydwatedfeatuwe
i-impowt com.twittew.home_mixew.modew.homefeatuwes.isnsfwfeatuwe
impowt com.twittew.home_mixew.modew.homefeatuwes.iswetweetfeatuwe
impowt com.twittew.home_mixew.modew.homefeatuwes.quotedtweetdwoppedfeatuwe
i-impowt com.twittew.home_mixew.modew.homefeatuwes.quotedtweetidfeatuwe
impowt com.twittew.home_mixew.modew.homefeatuwes.quotedusewidfeatuwe
i-impowt com.twittew.home_mixew.modew.homefeatuwes.souwcetweetidfeatuwe
impowt com.twittew.home_mixew.modew.homefeatuwes.souwceusewidfeatuwe
i-impowt com.twittew.home_mixew.modew.homefeatuwes.tweetwanguagefeatuwe
impowt com.twittew.home_mixew.modew.homefeatuwes.tweettextfeatuwe
impowt com.twittew.home_mixew.modew.wequest.fowwowingpwoduct
i-impowt com.twittew.home_mixew.modew.wequest.fowyoupwoduct
impowt c-com.twittew.home_mixew.modew.wequest.wisttweetspwoduct
i-impowt com.twittew.home_mixew.modew.wequest.scowedtweetspwoduct
impowt com.twittew.home_mixew.modew.wequest.subscwibedpwoduct
impowt com.twittew.home_mixew.utiw.tweetypie.wequestfiewds
impowt com.twittew.pwoduct_mixew.component_wibwawy.featuwe_hydwatow.candidate.tweet_is_nsfw.isnsfw
impowt com.twittew.pwoduct_mixew.component_wibwawy.featuwe_hydwatow.candidate.tweet_visibiwity_weason.visibiwityweason
i-impowt com.twittew.pwoduct_mixew.component_wibwawy.modew.candidate.tweetcandidate
impowt com.twittew.pwoduct_mixew.cowe.featuwe.featuwe
impowt com.twittew.pwoduct_mixew.cowe.featuwe.featuwemap.featuwemap
i-impowt com.twittew.pwoduct_mixew.cowe.featuwe.featuwemap.featuwemapbuiwdew
impowt com.twittew.pwoduct_mixew.cowe.functionaw_component.featuwe_hydwatow.candidatefeatuwehydwatow
i-impowt com.twittew.pwoduct_mixew.cowe.modew.common.identifiew.featuwehydwatowidentifiew
impowt c-com.twittew.pwoduct_mixew.cowe.pipewine.pipewinequewy
i-impowt c-com.twittew.spam.wtf.{thwiftscawa => wtf}
impowt com.twittew.stitch.stitch
i-impowt com.twittew.stitch.tweetypie.{tweetypie => tweetypiestitchcwient}
i-impowt com.twittew.tweetypie.{thwiftscawa => tp}
impowt com.twittew.utiw.wogging.wogging
impowt javax.inject.inject
impowt javax.inject.singweton

@singweton
cwass tweetypiefeatuwehydwatow @inject() (
  t-tweetypiestitchcwient: tweetypiestitchcwient, (///ˬ///✿)
  s-statsweceivew: s-statsweceivew)
    e-extends candidatefeatuwehydwatow[pipewinequewy, rawr x3 tweetcandidate]
    with wogging {

  ovewwide v-vaw identifiew: f-featuwehydwatowidentifiew = featuwehydwatowidentifiew("tweetypie")

  ovewwide v-vaw featuwes: s-set[featuwe[_, -.- _]] = set(
    authowidfeatuwe, ^^
    e-excwusiveconvewsationauthowidfeatuwe, (⑅˘꒳˘)
    inwepwytotweetidfeatuwe, nyaa~~
    i-ishydwatedfeatuwe, /(^•ω•^)
    isnsfw, (U ﹏ U)
    isnsfwfeatuwe, 😳😳😳
    iswetweetfeatuwe, >w<
    q-quotedtweetdwoppedfeatuwe, XD
    quotedtweetidfeatuwe, o.O
    quotedusewidfeatuwe, mya
    s-souwcetweetidfeatuwe, 🥺
    souwceusewidfeatuwe, ^^;;
    t-tweettextfeatuwe, :3
    t-tweetwanguagefeatuwe, (U ﹏ U)
    visibiwityweason
  )

  pwivate vaw defauwtfeatuwemap = featuwemapbuiwdew()
    .add(ishydwatedfeatuwe, OwO fawse)
    .add(isnsfw, 😳😳😳 nyone)
    .add(isnsfwfeatuwe, (ˆ ﻌ ˆ)♡ fawse)
    .add(quotedtweetdwoppedfeatuwe, XD f-fawse)
    .add(tweettextfeatuwe, (ˆ ﻌ ˆ)♡ n-nyone)
    .add(visibiwityweason, ( ͡o ω ͡o ) nyone)
    .buiwd()

  o-ovewwide def appwy(
    q-quewy: pipewinequewy, rawr x3
    c-candidate: tweetcandidate, nyaa~~
    existingfeatuwes: featuwemap
  ): stitch[featuwemap] = {
    v-vaw safetywevew = quewy.pwoduct match {
      case fowwowingpwoduct => w-wtf.safetywevew.timewinehomewatest
      case f-fowyoupwoduct =>
        v-vaw i-innetwowk = existingfeatuwes.getowewse(innetwowkfeatuwe, >_< twue)
        i-if (innetwowk) w-wtf.safetywevew.timewinehome e-ewse wtf.safetywevew.timewinehomewecommendations
      c-case scowedtweetspwoduct => wtf.safetywevew.timewinehome
      case wisttweetspwoduct => w-wtf.safetywevew.timewinewists
      c-case subscwibedpwoduct => w-wtf.safetywevew.timewinehomesubscwibed
      c-case u-unknown => thwow nyew unsuppowtedopewationexception(s"unknown pwoduct: $unknown")
    }

    vaw tweetfiewdsoptions = t-tp.gettweetfiewdsoptions(
      tweetincwudes = wequestfiewds.tweettphydwationfiewds, ^^;;
      incwudewetweetedtweet = twue, (ˆ ﻌ ˆ)♡
      incwudequotedtweet = t-twue, ^^;;
      visibiwitypowicy = tp.tweetvisibiwitypowicy.usewvisibwe, (⑅˘꒳˘)
      safetywevew = s-some(safetywevew), rawr x3
      f-fowusewid = quewy.getoptionawusewid
    )

    vaw e-excwusiveauthowidopt =
      existingfeatuwes.getowewse(excwusiveconvewsationauthowidfeatuwe, (///ˬ///✿) n-nyone)

    tweetypiestitchcwient.gettweetfiewds(tweetid = candidate.id, 🥺 o-options = t-tweetfiewdsoptions).map {
      case tp.gettweetfiewdswesuwt(_, >_< tp.tweetfiewdswesuwtstate.found(found), UwU quoteopt, >_< _) =>
        vaw cowedata = found.tweet.cowedata
        v-vaw isnsfwadmin = cowedata.exists(_.nsfwadmin)
        v-vaw isnsfwusew = cowedata.exists(_.nsfwusew)

        v-vaw q-quotedtweetdwopped = quoteopt.exists {
          case _: tp.tweetfiewdswesuwtstate.fiwtewed => t-twue
          case _: t-tp.tweetfiewdswesuwtstate.notfound => twue
          c-case _ => f-fawse
        }
        vaw quotedtweetisnsfw = quoteopt.exists {
          case quotetweet: t-tp.tweetfiewdswesuwtstate.found =>
            q-quotetweet.found.tweet.cowedata.exists(data => d-data.nsfwadmin || data.nsfwusew)
          c-case _ => f-fawse
        }

        vaw souwcetweetisnsfw =
          f-found.wetweetedtweet.exists(_.cowedata.exists(data => data.nsfwadmin || data.nsfwusew))

        vaw tweettext = cowedata.map(_.text)
        vaw t-tweetwanguage = f-found.tweet.wanguage.map(_.wanguage)

        vaw tweetauthowid = cowedata.map(_.usewid)
        v-vaw inwepwytotweetid = c-cowedata.fwatmap(_.wepwy.fwatmap(_.inwepwytostatusid))
        vaw wetweetedtweetid = found.wetweetedtweet.map(_.id)
        vaw quotedtweetid = q-quoteopt.fwatmap {
          case quotetweet: tp.tweetfiewdswesuwtstate.found =>
            some(quotetweet.found.tweet.id)
          case _ => nyone
        }

        v-vaw wetweetedtweetusewid = found.wetweetedtweet.fwatmap(_.cowedata).map(_.usewid)
        vaw quotedtweetusewid = q-quoteopt.fwatmap {
          c-case quotetweet: tp.tweetfiewdswesuwtstate.found =>
            quotetweet.found.tweet.cowedata.map(_.usewid)
          case _ => n-nyone
        }

        v-vaw isnsfw = isnsfwadmin || isnsfwusew || souwcetweetisnsfw || quotedtweetisnsfw

        featuwemapbuiwdew()
          .add(authowidfeatuwe, -.- t-tweetauthowid)
          .add(excwusiveconvewsationauthowidfeatuwe, mya excwusiveauthowidopt)
          .add(inwepwytotweetidfeatuwe, i-inwepwytotweetid)
          .add(ishydwatedfeatuwe, >w< twue)
          .add(isnsfw, (U ﹏ U) some(isnsfw))
          .add(isnsfwfeatuwe, 😳😳😳 isnsfw)
          .add(iswetweetfeatuwe, o.O w-wetweetedtweetid.isdefined)
          .add(quotedtweetdwoppedfeatuwe, quotedtweetdwopped)
          .add(quotedtweetidfeatuwe, òωó q-quotedtweetid)
          .add(quotedusewidfeatuwe, 😳😳😳 q-quotedtweetusewid)
          .add(souwcetweetidfeatuwe, σωσ wetweetedtweetid)
          .add(souwceusewidfeatuwe, (⑅˘꒳˘) w-wetweetedtweetusewid)
          .add(tweetwanguagefeatuwe, (///ˬ///✿) tweetwanguage)
          .add(tweettextfeatuwe, 🥺 t-tweettext)
          .add(visibiwityweason, OwO f-found.suppwessweason)
          .buiwd()

      // i-if nyo tweet wesuwt found, >w< wetuwn d-defauwt and pwe-existing f-featuwes
      case _ =>
        defauwtfeatuwemap ++ f-featuwemapbuiwdew()
          .add(authowidfeatuwe, 🥺 e-existingfeatuwes.getowewse(authowidfeatuwe, nyaa~~ n-nyone))
          .add(excwusiveconvewsationauthowidfeatuwe, ^^ excwusiveauthowidopt)
          .add(inwepwytotweetidfeatuwe, >w< existingfeatuwes.getowewse(inwepwytotweetidfeatuwe, OwO n-nyone))
          .add(iswetweetfeatuwe, XD existingfeatuwes.getowewse(iswetweetfeatuwe, ^^;; f-fawse))
          .add(quotedtweetidfeatuwe, 🥺 e-existingfeatuwes.getowewse(quotedtweetidfeatuwe, XD nyone))
          .add(quotedusewidfeatuwe, existingfeatuwes.getowewse(quotedusewidfeatuwe, nyone))
          .add(souwcetweetidfeatuwe, (U ᵕ U❁) e-existingfeatuwes.getowewse(souwcetweetidfeatuwe, n-nyone))
          .add(souwceusewidfeatuwe, :3 e-existingfeatuwes.getowewse(souwceusewidfeatuwe, n-nyone))
          .add(tweetwanguagefeatuwe, ( ͡o ω ͡o ) existingfeatuwes.getowewse(tweetwanguagefeatuwe, n-nyone))
          .buiwd()
    }
  }
}
