!function(O){var e,N,t,n,a,o={hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",searchDelay:500,minChars:1,tokenLimit:null,jsonContainer:null,method:"GET",contentType:"json",queryParam:"q",tokenDelimiter:",",preventDuplicates:!1,prePopulate:null,processPrePopulate:!1,makeSortable:!1,escapeHTML:!0,animateDropdown:!0,onResult:null,onAdd:null,onDelete:null,noCache:!1},_={tokenList:"autocomplete",sortable:"sortable",token:"added tag",tokenDelete:"delete",selectedToken:"selected",highlightedToken:"highlighted",dropdown:"autocomplete dropdown",dropdownItem:"even",dropdownItem2:"odd",selectedDropdownItem:"selected",inputToken:"input",insertBefore:"selected",insertAfter:"selected"},j=0,U=1,S=2;KeyboardEvent.prototype.hasOwnProperty("key")?(e=!0,N={BACKSPACE:"Backspace",TAB:"Tab",ENTER:"Enter",ESCAPE:"Escape",SPACE:" ",PAGE_UP:"PageUp",PAGE_DOWN:"PageDown",END:"End",HOME:"Home",LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown",DELETE:"Delete",NUMPAD_ENTER:"Enter",COMMA:","}):(N={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,NUMPAD_ENTER:108,COMMA:188},Object.defineProperty(KeyboardEvent.prototype,"key",{configurable:!0,enumerable:!0,get:function(){return this.keyCode}})),e&&(t=KeyboardEvent.prototype,n=Object.getOwnPropertyDescriptor(t,"key"),a={Spacebar:" ",Esc:"Escape",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete"},Object.defineProperty(t,"key",{configurable:!0,enumerable:!0,get:function(){var e=n.get.call(this);return a.hasOwnProperty(e)?a[e]:e}})),O.fn.tokenInput=function(e,t){var n=O.extend({},o,t||{});return this.each(function(){new O.TokenList(this,e,n)})},O.TokenList=function(e,t,r){"string"==typeof t?(r.url=t,void 0===r.crossDomain&&(-1===r.url.indexOf("://")?r.crossDomain=!1:r.crossDomain=location.href.split(/\/+/g)[1]!==r.url.split(/\/+/g)[1])):"object"==typeof t&&(r.local_data=t),r.classes?r.classes=O.extend({},_,r.classes):r.theme?(r.classes={},O.each(_,function(e,t){r.classes[e]=t+"-"+r.theme})):r.classes=_;var n,s=[],l=0,o=new O.TokenList.Cache,a=O(e).attr("id");O('label[for="'+a+'"]').attr({for:a+"_autocomplete"});var c=O('<input type="text" class="text" autocomplete="off" role="combobox" aria-expanded="true" aria-autocomplete="list">').attr({id:a+"_autocomplete"}).focus(function(){(null===r.tokenLimit||l<r.tokenLimit)&&(O(this).val().length>=r.minChars?setTimeout(function(){R()},5):r.hintText&&(k.html("<p class='notice'>"+r.hintText+"</p>"),P()))}).blur(function(){w()}).keydown(function(e){var t,n;switch(e.key){case N.LEFT:case N.RIGHT:case N.UP:case N.DOWN:if(f&&!f.is(":hidden")){if(e.key===N.LEFT||e.key===N.RIGHT)return!0;var a=null;return(a=p?e.key===N.DOWN?O(p).next():O(p).prev():f).length?(L(a),O(k).scrollTo(O(a))):e.key===N.UP&&p&&b(O(p)),!1}i?(t=O(i).prev(),n=O(i).next(),e.key===N.LEFT||e.key===N.UP?D(O(i),j):D(O(i),U)):(t=v.prev(),n=v.next()),e.key!==N.LEFT&&e.key!==N.UP||!t.length?e.key!==N.RIGHT&&e.key!==N.DOWN||!n.length||C(O(n.get(0))):C(O(t.get(0)));break;case N.BACKSPACE:case N.DELETE:if(t=v.prev(),!O(this).val().length)return i?y(O(i)):t.length&&C(O(t.get(0))),!1;1===O(this).val().length?w():setTimeout(function(){R()},25);break;case N.COMMA:case N.TAB:case N.ENTER:case N.NUMPAD_ENTER:if(p){if(E(O(p)),b(O(p)),w(),e.keyCode===N.TAB&&r.tokenLimit&&r.tokenLimit===l)break;return!1}if(c.val()){if(O.each(c.val().split(r.tokenDelimiter),function(e,t){E(O.trim(t))}),w(),e.keyCode===N.TAB&&r.tokenLimit&&r.tokenLimit===l)break;return!1}break;case N.ESCAPE:return w(),!0;default:String.fromCharCode(e.which)&&setTimeout(function(){R()},25)}});O(e).closest("form").submit(function(){c.val()&&O.each(c.val().split(r.tokenDelimiter),function(e,t){E(O.trim(t))})});var u=O(e).hide().focus(function(){c.focus()}).blur(function(){c.blur()}),i=null,d=0,p=null,f=null,h=O("<ul />").addClass(r.classes.tokenList).click(function(e){var t=O(e.target).closest("li");t&&t.get(0)&&O.data(t.get(0),"tokeninput")?function(e){var t=i;if(i){if(i===e.get(0))return function(e){w();var t=O.data(e.get(0),"tokeninput");y(e),c.val(t.id)}(e);D(O(i),S)}t===e.get(0)?D(e,S):C(e)}(t):(i&&D(O(i),S),c.focus())}).mouseover(function(e){var t=O(e.target).closest("li");t&&i!==this&&t.addClass(r.classes.highlightedToken)}).mouseout(function(e){var t=O(e.target).closest("li");t&&i!==this&&t.removeClass(r.classes.highlightedToken)}).insertBefore(u);r.makeSortable&&h.addClass(r.classes.sortable);var m,v=O("<li />").addClass(r.classes.inputToken).appendTo(h).append(c),k=O("<div>").addClass(r.classes.dropdown).insertAfter(c).hide(),g=O(e).val()||r.prePopulate;function T(e,t){if(!(0<=t.indexOf(r.tokenDelimiter))){var n=O("<li>"+x(t)+" </li>").addClass(r.classes.token).insertBefore(v);r.makeSortable;var a=O("<span></span>").addClass(r.classes.tokenDelete).appendTo(n).click(function(){return y(O(this).parent()),!1});O('<a href="#">'+r.deleteText+"</a>").attr("title","remove "+t).appendTo(a);var o={id:e,name:t};O.data(n.get(0),"tokeninput",o),s=s.slice(0,d).concat([o]).concat(s.slice(d)),d++;var i=O.map(s,function(e){return e.id});return u.val(i.join(r.tokenDelimiter)),l+=1,n}O.each(t.split(r.tokenDelimiter),function(e,t){T(t,t)})}function E(e){var n="string"===O.type(e)?{id:e,name:e}:O.data(e.get(0),"tokeninput");c.val("");var t=r.onAdd;if(0<l&&r.preventDuplicates){var a=null;if(h.children().each(function(){var e=O(this),t=O.data(e.get(0),"tokeninput");if(t&&t.id===n.id)return a=e,!1}),a)return C(a),void c.focus()}T(n.id,n.name),null!==r.tokenLimit&&l>=r.tokenLimit?(c.parent().prev("li").find("a").focus(),c.hide()):c.focus(),w(),O.isFunction(t)&&t.call(u,n),c.change()}function C(e){e.addClass(r.classes.selectedToken),i=e.get(0),c.val(""),w()}function D(e,t){e.removeClass(r.classes.selectedToken),i=null,t===j?d--:t===U?d++:d=l,c.focus()}function y(e){var t=O.data(e.get(0),"tokeninput"),n=r.onDelete,a=e.prevAll().length;d<a&&a--,e.remove(),i=null,c.focus(),s=s.slice(0,a).concat(s.slice(a+1)),a<d&&d--;var o=O.map(s,function(e){return e.id});u.val(o.join(r.tokenDelimiter)),--l,null!==r.tokenLimit&&c.show().val("").focus(),O.isFunction(n)&&n.call(u,t),c.change()}function w(){k.hide(),p&&O(p).removeClass(r.classes.selectedToken),p=null}function P(){k.css({position:"absolute"}).css("z-index",999).show()}function A(s,e){var l;e&&e.length?(k.empty(),l=O('<ul role="listbox" aria-activedescendant="ui-active-menuitem">').appendTo(k).mouseover(function(e){L(O(e.target).closest("li"))}).mousedown(function(e){return E(O(e.target).closest("li")),!1}).hide(),O.each(e,function(e,t){var n,a,o,i=O('<li role="option">'+(n=x(t.name),a=s,o=n,O.each(a.split(" "),function(e,t){t&&(t=t.replace(/([.?*+^$[\]\\(){}-])/g,"\\$1"),o=o.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>"))}),o)+"</li>").appendTo(l);e%2?i.addClass(r.classes.dropdownItem):i.addClass(r.classes.dropdownItem2),0===e&&(f=i),O.data(i.get(0),"tokeninput",{id:t.id,name:t.name})}),P(),r.animateDropdown?l.slideDown("fast"):l.show()):r.noResultsText&&(k.html("<p class='notice'>"+r.noResultsText+"</p>"),P())}function L(e){e&&(p&&b(O(p)),e.addClass(r.classes.selectedDropdownItem),p=e.get(0))}function b(e){e.removeClass(r.classes.selectedDropdownItem),p=null}function x(e){return r.escapeHTML?O("<p></p>").text(e).html():e}function R(){var e=c.val().toLowerCase();(e&&e.length||0==r.minChars)&&(p&&b(O(p)),i&&D(O(i),U),0==r.minChars||e.length>=r.minChars?(r.searchingText&&(k.html("<p class='notice'>"+r.searchingText+"</p>"),P()),clearTimeout(n),n=setTimeout(function(){!function(e){{var t;r.noCache||(t=o.get(e))}!r.noCache&&t?A(e,t):function(t){{var e;r.url?function(t){var i={data:{}};{var e,n;-1<r.url.indexOf("?")?(e=r.url.split("?"),i.url=e[0],n=e[1].split("&"),O.each(n,function(e,t){var n=t.split("=");i.data[n[0]]=n[1]})):i.url=r.url}{var a;r.liveParams&&(a=r.liveParams.split("&"),O.each(a,function(e,t){var n=t.split("="),a="#"+n[1]+" input";0===O(a).size()?a="#"+n[1]:a+=":checked";var o=O(a).map(function(e,t){return O(t).val()}).get();o&&(i.data[n[0]]=o)}))}i.data[r.queryParam]=t,i.type=r.method,i.dataType=r.contentType,r.crossDomain&&(i.dataType="jsonp");i.success=function(e){O.isFunction(r.onResult)&&(e=r.onResult.call(u,e)),r.noCache||o.add(t,r.jsonContainer?e[r.jsonContainer]:e),c.val().toLowerCase()===t&&c.is(":focus")&&A(t,r.jsonContainer?e[r.jsonContainer]:e)},O.ajax(i)}(t):r.local_data&&(e=O.grep(r.local_data,function(e){return-1<e.name.toLowerCase().indexOf(t.toLowerCase())}),O.isFunction(r.onResult)&&(e=r.onResult.call(u,e)),o.add(t,e),A(t,e))}}(e)}(e)},r.searchDelay)):w())}r.processPrePopulate&&O.isFunction(r.onResult)&&(g=r.onResult.call(u,g)),O(e).val(""),u.val(""),c.val(""),g&&g.length&&("string"==typeof g?T(g,g):O.each(g,function(e,t){T(t.id,t.name)})),null!==r.tokenLimit&&l>=r.tokenLimit&&c.hide(),r.liveParams&&(m=r.liveParams.split("&"),O.each(m,function(e,t){var n=t.split("="),a="#"+n[1]+" input";0===O(a).size()&&(a="#"+n[1]),O(a).each(function(e,t){O(t).hasClass("autocomplete")&&(t=O(t).prev().find("input").first()),O(t).change(function(e){o.clear_data()})})}))},O.TokenList.Cache=function(e){function n(){o={},i=0}var a=O.extend({max_size:500},e),o={},i=0;this.clear_data=function(){n()},this.add=function(e,t){i>a.max_size&&n(),o[e]||(i+=1),o[e]=t},this.get=function(e){return o[e]}}}(jQuery);
